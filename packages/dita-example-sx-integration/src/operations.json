{
	"contextual-edit-note[@conref]": {
		"label": "Edit",
		"description": "Edit a conref to another existing node.",
		"steps": [
			{
				"type": "transform/resolveDitaUrl",
				"data": {
					"continueOnError": true,
					"url": "x__$data('contextNode')/@conref"
				}
			},
			{
				"type": "operation/open-document-with-link-selector-browser-modal",
				"data": {
					"documentId": "{{targetDocumentId}}",
					"linkableElementsQuery": "/descendant::note[@id]",
					"modalPrimaryButtonLabel": "Save",
					"modalTitle": "Replace reused note",
					"nodeId": "{{targetNodeId}}"
				}
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "operation/replace-node",
				"data": {
					"replacementNodeStructure": [
						"note",
						{
							"conref": "{{url}}"
						}
					]
				}
			}
		]
	},
	"insert-note[@conref]": {
		"label": "Conref a note",
		"description": "Insert a conref to an existing node.",
		"steps": [
			{
				"type": "operation/open-document-with-link-selector-browser-modal",
				"data": {
					"linkableElementsQuery": "/descendant::note[@id]",
					"modalTitle": "Add reused note"
				}
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "operation/vertical-insert",
				"data": {
					"childNodeStructure": [
						"note",
						{
							"conref": "{{url}}"
						}
					]
				}
			}
		]
	},
	":_open-document-with-link-selector-browser-for-edit": {
		"initialData": {
			"modalPrimaryButtonLabel": "Save",
			"modalTitle": "Replace cross link"
		},
		"steps": [
			{
				"type": "transform/resolveDitaUrl",
				"data": {
					"continueOnError": true,
					"url": "x__$data('contextNode')/@href"
				}
			},
			{
				"type": "operation/open-document-with-link-selector-browser-modal",
				"data": {
					"documentId": "{{targetDocumentId}}",
					"nodeId": "{{targetNodeId}}"
				}
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},
	":_open-document-with-link-selector-browser-for-insert": {
		"initialData": {
			"modalTitle": "Add cross link"
		},
		"steps": [
			{
				"type": "operation/open-document-with-link-selector-browser-modal"
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},
	":_open-image-browser-for-edit": {
		"steps": [
			{
				"type": "transform/setDocumentIdToDocumentContainingContextNodeId"
			},
			{
				"type": "transform/isDocumentIdOutOfSync"
			},
			{
				"type": "transform/setRemoteDocumentIdFromDocumentId"
			},
			{
				"type": "operation/open-image-browser-modal",
				"data": {
					"modalPrimaryButtonLabel": "Replace",
					"selectedImageId": "x__$data('contextNode')/@href",
					"browseContextDocumentId": "{{remoteDocumentId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl",
				"data": {
					"url": "{{selectedImageId}}"
				}
			}
		]
	},
	":_open-image-browser-for-insert": {
		"steps": [
			{
				"type": "transform/setContextNodeIdToSelectedElement"
			},
			{
				"type": "transform/setDocumentIdToDocumentContainingContextNodeId"
			},
			{
				"type": "transform/setRemoteDocumentIdFromDocumentId"
			},
			{
				"type": "operation/open-image-browser-modal",
				"data": {
					"browseContextDocumentId": "{{remoteDocumentId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl",
				"data": {
					"url": "{{selectedImageId}}"
				}
			}
		]
	},
	":_open-web-reference-modal-for-edit": {
		"steps": [
			{
				"type": "operation/open-web-reference-modal-for-edit",
				"data": {
					"url": "x__$data('contextNode')/@href"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},
	":_open-web-reference-modal-for-insert": {
		"steps": [
			{
				"type": "operation/open-web-reference-modal-for-insert"
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},

	":_open-project-browser-for-insert": {
		"initialData": {
			"modalTitle": "Add local project link"
		},
		"steps": [
			{
				"type": "operation/open-project-browser-modal"
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},
	":_open-project-browser-for-edit": {
		"initialData": {
			"modalPrimaryButtonLabel": "Save",
			"modalTitle": "Replace local project link"
		},
		"steps": [
			{
				"type": "transform/resolveDitaUrl",
				"data": {
					"continueOnError": true,
					"url": "x__$data('contextNode')/@href"
				}
			},
			{
				"type": "operation/open-project-browser-modal",
				"data": {
					"documentId": "{{targetDocumentId}}",
					"nodeId": "{{targetNodeId}}"
				}
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},

	":insert-xref[@format=dita @type=local-project]": {
		"label": "t__Local project link",
		"description": "t__A link to content in this or another topic tht is already loaded.",
		"icon": "link",
		"steps": [
			{
				"type": "operation/:_open-project-browser-for-insert"
			},
			{
				"type": "operation/insert-inline-frame-element",
				"data": {
					"nodeName": "xref",
					"attributes": {
						"href": "{{reference}}",
						"format": "dita",
						"type": "local-project"
					}
				}
			}
		]
	},
	":contextual-edit-xref[@format=dita @type=local-project]": {
		"label": "t__Edit",
		"steps": [
			{
				"type": "operation/:_open-project-browser-for-edit",
				"data": {
					"contextNodeId": "{{contextNodeId}}"
				}
			},
			{
				"type": "operation/set-attributes",
				"data": {
					"attributes": {
						"href": "{{reference}}",
						"format": "dita"
					},
					"contextNodeId": "{{contextNodeId}}"
				}
			}
		]
	},

	":_open-nodes-browser-for-insert": {
		"initialData": {
			"modalTitle": "Add local node link"
		},
		"steps": [
			{
				"type": "operation/open-nodes-browser-modal"
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},
	":_open-nodes-browser-for-edit": {
		"initialData": {
			"modalPrimaryButtonLabel": "Save",
			"modalTitle": "Replace local node link"
		},
		"steps": [
			{
				"type": "transform/resolveDitaUrl",
				"data": {
					"continueOnError": true,
					"url": "x__$data('contextNode')/@href"
				}
			},
			{
				"type": "operation/open-nodes-browser-modal",
				"data": {
					"documentId": "{{targetDocumentId}}",
					"nodeId": "{{targetNodeId}}"
				}
			},
			{
				"type": "transform/createDitaUrlFromLoadedTarget",
				"data": {
					"targetDocumentId": "{{documentId}}",
					"targetNodeId": "{{nodeId}}"
				}
			},
			{
				"type": "transform/setReferenceForUrl"
			}
		]
	},

	":insert-xref[@format=dita @type=local-node]": {
		"label": "t__Local node link",
		"description": "t__A link to content in this or another topic that is already loaded.",
		"icon": "link",
		"steps": [
			{
				"type": "operation/:_open-nodes-browser-for-insert"
			},
			{
				"type": "operation/insert-inline-frame-element",
				"data": {
					"nodeName": "xref",
					"attributes": {
						"href": "{{reference}}",
						"format": "dita",
						"type": "local-node"
					}
				}
			}
		]
	},
	":contextual-edit-xref[@format=dita @type=local-node]": {
		"label": "t__Edit",
		"steps": [
			{
				"type": "operation/:_open-nodes-browser-for-edit",
				"data": {
					"contextNodeId": "{{contextNodeId}}"
				}
			},
			{
				"type": "operation/set-attributes",
				"data": {
					"attributes": {
						"href": "{{reference}}",
						"format": "dita"
					},
					"contextNodeId": "{{contextNodeId}}"
				}
			}
		]
	}
}
